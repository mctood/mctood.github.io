<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
	table {
		width: 100%;
		border-collapse:collapse;
		border-spacing:0;
		height: auto;
		table-layout: fixed;
		margin-bottom: 50px;
	}
	table,td,th {
		border: 1px solid  #2b2b2b;
		width: 35px !important;
		height: 35px !important;
		padding: 0;
		vertical-align: middle;
		text-align: center;
		transition: .2s;
		font-size: x-large;
		
	}
	td:hover {
		background: #222;
	}
	body {
		padding-top: 50px;
		display: flex;
		justify-content: center;
		align-items: center;
		background: #141414;
		line-height: 0;
		flex-direction: column;
		user-select: none;
	}
	.pause {
		background-color: #ff222263 !important;
	}
	#pp {
		background-color: #22ff2263;
		color: #fff;
	}
	.active {
		background-color: #ffff0063 !important;
	}
	[n] {
		background-color: gray;
	}
	button {
		width: 64px;
		height: 48px;
		font-weight: bolder;
		border: 0;
		border-radius: 7px;
		margin: 3px;
		cursor: pointer;
	}
	.bi::before {
		font-weight: bolder;
	}
	.arrow {
		color: white;
	}
	.dirman {
		color: lightcoral;
	}
	.generator {
		color: lightblue;
	}
	.random {
		color: lightgreen;
	}
	.green {
		color: lightgreen !important;
	}
</style>
<script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
    crossorigin="anonymous"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css">
<table class="field">
	<tr id="1">
		<td draggable data-n="1"></td>
		<td draggable data-n="2"></td>
		<td draggable data-n="3"></td>
		<td draggable data-n="4"></td>
		<td draggable data-n="5"></td>
		<td draggable data-n="6"></td>
		<td draggable data-n="7"></td>
		<td draggable data-n="8"></td>
		<td draggable data-n="9"></td>
			</tr>
	<tr id="2">
		<td draggable data-n="1"></td>
		<td draggable data-n="2"></td>
		<td draggable data-n="3"></td>
		<td draggable data-n="4"></td>
		<td draggable data-n="5"></td>
		<td draggable data-n="6"></td>
		<td draggable data-n="7"></td>
		<td draggable data-n="8"></td>
		<td draggable data-n="9"></td>
			</tr>
	<tr id="3">
		<td draggable data-n="1"></td>
		<td draggable data-n="2"></td>
		<td draggable data-n="3"></td>
		<td draggable data-n="4"></td>
		<td draggable data-n="5"></td>
		<td draggable data-n="6"></td>
		<td draggable data-n="7"></td>
		<td draggable data-n="8"></td>
		<td draggable data-n="9"></td>
			</tr>
	<tr id="4">
		<td draggable data-n="1"></td>
		<td draggable data-n="2"></td>
		<td draggable data-n="3"></td>
		<td draggable data-n="4"></td>
		<td draggable data-n="5"></td>
		<td draggable data-n="6"></td>
		<td draggable data-n="7"></td>
		<td draggable data-n="8"></td>
		<td draggable data-n="9"></td>
			</tr>
	<tr id="5">
		<td draggable data-n="1"></td>
		<td draggable data-n="2"></td>
		<td draggable data-n="3"></td>
		<td draggable data-n="4"></td>
		<td draggable data-n="5"></td>
		<td draggable data-n="6"></td>
		<td draggable data-n="7"></td>
		<td draggable data-n="8"></td>
		<td draggable data-n="9"></td>
			</tr>
	<tr id="6">
		<td draggable data-n="1"></td>
		<td draggable data-n="2"></td>
		<td draggable data-n="3"></td>
		<td draggable data-n="4"></td>
		<td draggable data-n="5"></td>
		<td draggable data-n="6"></td>
		<td draggable data-n="7"></td>
		<td draggable data-n="8"></td>
		<td draggable data-n="9"></td>
			</tr>
	<tr id="7">
		<td draggable data-n="1"></td>
		<td draggable data-n="2"></td>
		<td draggable data-n="3"></td>
		<td draggable data-n="4"></td>
		<td draggable data-n="5"></td>
		<td draggable data-n="6"></td>
		<td draggable data-n="7"></td>
		<td draggable data-n="8"></td>
		<td draggable data-n="9"></td>
			</tr>
	<tr id="8">
		<td draggable data-n="1"></td>
		<td draggable data-n="2"></td>
		<td draggable data-n="3"></td>
		<td draggable data-n="4"></td>
		<td draggable data-n="5"></td>
		<td draggable data-n="6"></td>
		<td draggable data-n="7"></td>
		<td draggable data-n="8"></td>
		<td draggable data-n="9"></td>
			</tr>
	<tr id="9">
		<td draggable data-n="1"></td>
		<td draggable data-n="2"></td>
		<td draggable data-n="3"></td>
		<td draggable data-n="4"></td>
		<td draggable data-n="5"></td>
		<td draggable data-n="6"></td>
		<td draggable data-n="7"></td>
		<td draggable data-n="8"></td>
		<td draggable data-n="9"></td>
	</tr>
</table>




<script>
	var mouseDown = 0;
	
	
	
	let select = 1;
	let field = [];
	let nextField = [];

	for (let i = 0; i < 9; i++) {
		let temp = [];
		for (let j = 0; j < 9; j++) {
			temp.push(0);
		}
		field.push(temp);
	}

	for (let i = 0; i < 9; i++) {
		let temp = [];
		for (let j = 0; j < 9; j++) {
			temp.push(0);
		}
		nextField.push(temp);
	}
	let variants = {
		0: ``,
		1: `<i class="bi bi-arrow-right arrow"></i>`,
		2: `<i class="bi bi-arrow-left arrow"></i>`,
		3: `<i class="bi bi-arrow-up arrow"></i>`,
		4: `<i class="bi bi-arrow-down arrow"></i>`,
		5: `<i class="bi bi-arrow-bar-up dirman"></i>`,
		6: `<i class="bi bi-arrow-bar-right dirman"></i>`,
		7: `<i class="bi bi-arrow-bar-down dirman"></i>`,
		8: `<i class="bi bi-arrow-bar-left dirman"></i>`,
		9: `<i class="bi bi-box-arrow-right generator"></i>`,
		10: `<i class="bi bi-box-arrow-left generator"></i>`,
		11: `<i class="bi bi-box-arrow-up generator"></i>`,
		12: `<i class="bi bi-box-arrow-down generator"></i>`,
		13: `<i class="bi bi-question-lg random"></i>`,

	}
	console.log(field.length);
	let skipxs = [];
	let skipys = [];
	function render() {
		$(".field tr").each(function(i, e) {
			$(e).children().each((j, v) => {
				$(v).html(variants[nextField[i][j]])
			})
		})
	}
	function renderf() {
		$(".field tr").each(function(i, e) {
			$(e).children().each((j, v) => {
				$(v).html(variants[field[i][j]])
			})
		})
	}
	render();
	let genStop_r = [];
	let genStop_l = [];
	let genStop_u = [];
	let genStop_d = [];
	function step() {
		$(".field tr").each(function(i, e) {
			$(e).children().each((j, v) => {


				if (field[i][j] == 1) {
if (!skipxs.includes(j)) {
	if (j != 8) {
		if (field[i][j + 1] == 5) {
			nextField[i-1][j] = 3;
		}
		else if (field[i][j + 1] == 6) {
			nextField[i][j+2] = 1;
			
		}
		else if (field[i][j + 1] == 7) {
			nextField[i + 1][j] = 4;
		}
		else if (field[i][j + 1] == 8) {
			nextField[i][j - 1] = 2;
		}
		else if (field[i][j + 1] == 13) {
			let rand = Math.floor(Math.random() * 3);
			if (rand == 0) {
				nextField[i-1][j+1] = 3;
			}
			else if (rand == 1) {
				nextField[i][j+2] = 1;
			}
			else if (rand == 2) {
				nextField[i+1][j+1] = 4;
			}
		}
		else {
			nextField[i][j+1] = 1;
		}
	}
}
else skipxs = [];
				}


				if (field[i][j] == 2) {
if (j != 0) {
	if (field[i][j - 1] == 5) {
		nextField[i-1][j] = 3;
	}
	else if (field[i][j - 1] == 6) {
		nextField[i][j+1] = 1;
		
	}
	else if (field[i][j - 1] == 7) {
		nextField[i + 1][j] = 4;
	}
	else if (field[i][j - 1] == 8) {
		nextField[i][j - 2] = 2;
	}
	else if (field[i][j - 1] == 13) {
		let rand = Math.floor(Math.random() * 3);
		if (rand == 0) {
			nextField[i-1][j-1] = 3;
		}
		else if (rand == 1) {
			nextField[i][j-2] = 2;
		}
		else if (rand == 2) {
			nextField[i+1][j-1] = 4;
		}
	}
	else {
		nextField[i][j-1] = 2;
	}
}
				}


				if (field[i][j] == 3) {
if (i != 0) {
	if (field[i - 1][j] == 5) {
		nextField[i - 2][j] = 3;
	}
	else if (field[i - 1][j] == 6) {
		nextField[i][j+1] = 1;
		
	}
	else if (field[i - 1][j] == 7) {
		nextField[i + 1][j] = 4;
	}
	else if (field[i - 1][j] == 8) {
		nextField[i][j - 1] = 2;
	}
	else if (field[i - 1][j] == 13) {
		let rand = Math.floor(Math.random() * 3);
		if (rand == 0) {
			nextField[i-2][j] = 3;
		}
		else if (rand == 1) {
			nextField[i-1][j-1] = 2;
		}
		else if (rand == 2) {
			nextField[i-1][j+1] = 1;
		}
	}
	else {
		nextField[i-1][j] = 3;
	}
}
				}


				if (field[i][j] == 4) {
if (!skipys.includes(i)) {
	field[i][j] = 0;
	if (i != 8) {
		if (field[i + 1][j] == 5) {
			nextField[i-1][j] = 3;
		}
		else if (field[i + 1][j] == 6) {
			nextField[i][j+1] = 1;
			
		}
		else if (field[i + 1][j] == 7) {
			nextField[i + 2][j] = 4;
		}
		else if (field[i + 1][j] == 8) {
			nextField[i][j - 1] = 2;
		}
		else if (field[i + 1][j] == 13) {
			let rand = Math.floor(Math.random() * 3);
			if (rand == 0) {
				nextField[i+2][j] = 4;
			}
			else if (rand == 1) {
				nextField[i+1][j-1] = 2;
			}
			else if (rand == 2) {
				nextField[i+1][j+1] = 1;
			}
		}
		else {
			nextField[i+1][j] = 4;
		}
	}
}
else skipys = [];
				}

				if (field[i][j] == 9) {
if (!genStop_r.find(e => e[0] == i && e[1] == j)) {
	j != 8 ? nextField[i][j+1] = 1 : null;
	genStop_r.push([i, j])
} else genStop_r.splice(genStop_r.findIndex(e => e[0] == i && e[1] == j), 1);

				}
				if (field[i][j] == 10) {
if (!genStop_l.find(e => e[0] == i && e[1] == j)) {
	j != 0 ? nextField[i][j-1] = 2 : null;
	genStop_l.push([i, j])
} else genStop_l.splice(genStop_l.findIndex(e => e[0] == i && e[1] == j), 1);

				}
				if (field[i][j] == 11) {
if (!genStop_u.find(e => e[0] == i && e[1] == j)) {
	i != 0 ? nextField[i-1][j] = 3 : null;
	genStop_u.push([i, j])
} else genStop_u.splice(genStop_u.findIndex(e => e[0] == i && e[1] == j), 1);

				}
				if (field[i][j] == 12) {
if (!genStop_d.find(e => e[0] == i && e[1] == j)) {
	i != 8 ? nextField[i+1][j] = 4 : null;
	genStop_d.push([i, j])
} else genStop_d.splice(genStop_d.findIndex(e => e[0] == i && e[1] == j), 1);

				}

				if ([5,6,7,8,9,10,11,12,13,14,15,16].includes(field[i][j])) nextField[i][j] = field[i][j];
			})
		})
		field = nextField;
		render();
		nextField = [];
		for (let i = 0; i < 9; i++) {
			let temp = [];
			for (let j = 0; j < 9; j++) {
				temp.push(0);
			}
			nextField.push(temp);
		}
	}
	$("td, td > *").on("click", function(e) {
		e.preventDefault();
		let t = $(e.target).hasClass("bi") ? $(e.target).parent() : $(e.target);
		field[parseInt(t.parent().attr("id")) - 1][parseInt(t.attr("data-n")) - 1] = select;
		renderf();
	})
	$(window).on("keypress", function(e) {
		e.preventDefault();
		if (!parseInt(e.key) && parseInt(e.key) !== 0) return;
		select = parseInt(e.key);
		$("#key").text(e.key);
		$("#char").text(variants[Number(e.key)]);
	})
	let playing = 0, interval = 0;
	function playpause() {
		if (!playing) {
			playing = 1;
			interval = setInterval(step, 100);
			$("#pp").html("<i class='bi bi-pause'></i>").addClass("pause")
		} else {
			playing = 0;
			clearInterval(interval);
			$("#pp").html("<i class='bi bi-play'></i>").removeClass("pause")
		}
	}
	function change(e) {
		select = parseInt($(e).attr("n"));
		$("button.changer").removeClass("active");
		$(e).addClass("active");
	}
	function clear() {
		for (let i = 0; i < 9; i++) {
			for (let j = 0; j < 9; j++) {
				field[i][j] = 0;
			}
		}
		for (let i = 0; i < 9; i++) {
			for (let j = 0; j < 9; j++) {
				nextField[i][j] = 0;
			}
		}
		renderf()
	}
	$(() => {
		$("#c").click(clear);
		
	});
</script>



<br>
<span style="margin-left: 30px; text-align: center;">
	<button style="background: #ff000077; color: white" onclick="clear()" id="c">
		<i class="bi bi-x-square"></i>
	</button>
	&ThickSpace;&ThickSpace;
	<button onclick="playpause()" id="pp">
		<i class="bi bi-play"></i>
	</button>
	&ThickSpace;&ThickSpace;
	<button onclick="change(this)" class="changer" n="0">
		<i class="bi bi-eraser"></i>
	</button>
	<br><br>
	<div style="margin-top: 10px;">
		<button onclick="change(this)" class="changer" n="1"><i class="bi bi-arrow-right"></i></button>
		<button onclick="change(this)" class="changer" n="2"><i class="bi bi-arrow-left"></i></button>
		<button onclick="change(this)" class="changer" n="3"><i class="bi bi-arrow-up"></i></button>
		<button onclick="change(this)" class="changer" n="4"><i class="bi bi-arrow-down"></i></button><br>
		<button onclick="change(this)" class="changer" n="6"><i class="bi bi-arrow-bar-right"></i></button>
		<button onclick="change(this)" class="changer" n="8"><i class="bi bi-arrow-bar-left"></i></button>
		<button onclick="change(this)" class="changer" n="5"><i class="bi bi-arrow-bar-up"></i></button>
		<button onclick="change(this)" class="changer" n="7"><i class="bi bi-arrow-bar-down"></i></button><br>
		<button onclick="change(this)" class="changer" n="9"><i class="bi bi-box-arrow-right"></i></button>
		<button onclick="change(this)" class="changer" n="10"><i class="bi bi-box-arrow-left"></i></button>
		<button onclick="change(this)" class="changer" n="11"><i class="bi bi-box-arrow-up"></i></button>
		<button onclick="change(this)" class="changer" n="12"><i class="bi bi-box-arrow-down"></i></button><br>
		<button onclick="change(this)" class="changer" n="13"><i class="bi bi-question-lg"></i></button>
		<button onclick="change(this)" class="changer" n="14"><i class="bi bi-caret-left-square-fill"></i></button>
		<button onclick="change(this)" class="changer" n="15"><i class="bi bi-caret-up-square-fill"></i></button>
		<button onclick="change(this)" class="changer" n="16"><i class="bi bi-caret-down-square-fill"></i></button>
	</div>
</span>